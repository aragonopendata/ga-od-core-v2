{% extends 'health/base.html' %}

{% block title %}Connector Health Monitor{% endblock %}

{% block content %}
<button class="refresh-button" onclick="window.location.reload()">
    üîÑ Refresh Data
</button>

<!-- Filter Controls -->
<div class="filter-controls">
    <label>Filter by Status:</label>
    <a href="?status=all" class="filter-button {% if current_status_filter == 'all' %}active{% endif %}">All</a>
    <a href="?status=healthy" class="filter-button {% if current_status_filter == 'healthy' %}active{% endif %}">Healthy</a>
    <a href="?status=unhealthy" class="filter-button {% if current_status_filter == 'unhealthy' %}active{% endif %}">Unhealthy</a>
    <a href="?status=unknown" class="filter-button {% if current_status_filter == 'unknown' %}active{% endif %}">Unknown</a>
</div>

<!-- Summary Cards -->
<div class="summary-cards">
    <div class="stat-card total">
        <div class="stat-number">{{ connector_health_data.total_count }}</div>
        <div class="stat-label">Total Connectors</div>
    </div>
    <div class="stat-card healthy">
        <div class="stat-number">{{ connector_health_data.healthy_count }}</div>
        <div class="stat-label">Healthy</div>
    </div>
    <div class="stat-card unhealthy">
        <div class="stat-number">{{ connector_health_data.unhealthy_count }}</div>
        <div class="stat-label">Unhealthy</div>
    </div>
    <div class="stat-card unknown">
        <div class="stat-number">{{ connector_health_data.unknown_count }}</div>
        <div class="stat-label">Unknown</div>
    </div>
</div>

<!-- Connectors Table -->
{% if connector_health_data.connectors %}
<div class="health-table">
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Type</th>
                <th>Status</th>
                <th>Last Check</th>
            </tr>
        </thead>
        <tbody>
            {% for connector in connector_health_data.connectors %}
            <tr class="table-row {{ connector.status_class }}"
                onclick="window.location.href='{% url 'gaodcore_health:connector_detail' connector.id %}';">
                <td>
                    <span class="item-id">{{ connector.id }}</span>
                </td>
                <td>
                    <span class="item-name">{{ connector.name }}</span>
                </td>
                <td>
                    {{ connector.object.connector_type|default:"Unknown" }}
                </td>
                <td>
                    <span class="status-icon">
                        {% if connector.status_class == 'healthy' %}
                            ‚úÖ
                        {% elif connector.status_class == 'unhealthy' %}
                            ‚ùå
                        {% else %}
                            ‚ö†Ô∏è
                        {% endif %}
                    </span>
                </td>
                <td>
                    <span class="last-check">
                        {% if connector.last_check %}
                            {{ connector.last_check|date:"M d, H:i" }}
                        {% else %}
                            Never
                        {% endif %}
                    </span>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if is_paginated %}
<div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1{% if current_status_filter != 'all' %}&status={{ current_status_filter }}{% endif %}">&laquo; First</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if current_status_filter != 'all' %}&status={{ current_status_filter }}{% endif %}">Previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if current_status_filter != 'all' %}&status={{ current_status_filter }}{% endif %}">Next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if current_status_filter != 'all' %}&status={{ current_status_filter }}{% endif %}">Last &raquo;</a>
        {% endif %}
    </span>
</div>
{% endif %}

{% else %}
<div class="empty-state">
    <h3>No Connectors Found</h3>
    <p>No enabled connectors are currently configured for monitoring.</p>
    <p>Create connectors in the connector management interface.</p>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    // Add click handler for table rows
    document.querySelectorAll('.table-row').forEach(row => {
        row.addEventListener('click', function() {
            const url = this.getAttribute('onclick').match(/'([^']+)'/)[1];
            window.location.href = url;
        });
    });
</script>
{% endblock %}
