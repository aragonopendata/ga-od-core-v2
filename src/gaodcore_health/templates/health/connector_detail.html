{% extends 'health/base.html' %}

{% block title %}{{ connector.name }} - Connector Details{% endblock %}

{% block content %}
<button class="refresh-button" onclick="window.location.reload()">
    üîÑ Refresh Data
</button>

<!-- Connector Information -->
<div class="detail-section">
    <h2>üìä Connector Information</h2>
    <div class="detail-fields">
        <div class="field-row">
            <span class="field-label">ID:</span>
            <span class="field-value">{{ connector.id }}</span>
        </div>
        <div class="field-row">
            <span class="field-label">Name:</span>
            <span class="field-value">{{ connector.name }}</span>
        </div>
        <div class="field-row">
            <span class="field-label">URI:</span>
            <span class="field-value">{{ connector.uri }}</span>
        </div>
        <div class="field-row">
            <span class="field-label">Enabled:</span>
            <span class="field-value">
                {% if connector.enabled %}
                    ‚úÖ Yes
                {% else %}
                    ‚ùå No
                {% endif %}
            </span>
        </div>
        <div class="field-row">
            <span class="field-label">Created:</span>
            <span class="field-value">{{ connector.created_at|date:"M d, Y H:i" }}</span>
        </div>
        <div class="field-row">
            <span class="field-label">Updated:</span>
            <span class="field-value">{{ connector.updated_at|date:"M d, Y H:i" }}</span>
        </div>
    </div>
</div>

<!-- Health Information -->
<div class="detail-section">
    <h2>üè• Health Information</h2>
    {% if connector_health_data.connectors %}
        {% for health in connector_health_data.connectors %}
        <div class="detail-fields">
            <div class="field-row">
                <span class="field-label">Status:</span>
                <span class="field-value">
                    <span class="status-icon">
                        {% if health.status_class == 'healthy' %}
                            ‚úÖ
                        {% elif health.status_class == 'unhealthy' %}
                            ‚ùå
                        {% else %}
                            ‚ö†Ô∏è
                        {% endif %}
                    </span>
                    <span class="status-text {{ health.status_class }}">{{ health.status }}</span>
                </span>
            </div>
            <div class="field-row">
                <span class="field-label">Last Check:</span>
                <span class="field-value">
                    {% if health.last_check %}
                        {{ health.last_check|date:"M d, Y H:i:s" }}
                    {% else %}
                        Never
                    {% endif %}
                </span>
            </div>
            <div class="field-row">
                <span class="field-label">Response Time:</span>
                <span class="field-value">
                    {% if health.response_time_ms %}
                        {{ health.response_time_ms }}ms
                    {% else %}
                        N/A
                    {% endif %}
                </span>
            </div>
            {% if health.error_message %}
            <div class="field-row">
                <span class="field-label">Error:</span>
                <span class="field-value error-text">{{ health.error_message }}</span>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    {% else %}
        <p class="no-data">No health data available for this connector.</p>
    {% endif %}
</div>

<!-- Resources -->
<div class="detail-section">
    <h2>üìã Resources ({{ resource_health_data.total_count }})</h2>

    {% if resource_health_data.resources %}
    <div class="health-table">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Status</th>
                    <th>Last Check</th>
                </tr>
            </thead>
            <tbody>
                {% for resource in resource_health_data.resources %}
                <tr class="table-row {{ resource.status_class }}"
                    onclick="window.location.href='{% url 'gaodcore_health:resource_detail' resource.id %}';">
                    <td>
                        <span class="item-id">{{ resource.id }}</span>
                    </td>
                    <td>
                        <span class="item-name">{{ resource.name }}</span>
                    </td>
                    <td>
                        <span class="status-icon">
                            {% if resource.status_class == 'healthy' %}
                                ‚úÖ
                            {% elif resource.status_class == 'unhealthy' %}
                                ‚ùå
                            {% else %}
                                ‚ö†Ô∏è
                            {% endif %}
                        </span>
                    </td>
                    <td>
                        <span class="last-check">
                            {% if resource.last_check %}
                                {{ resource.last_check|date:"M d, H:i" }}
                            {% else %}
                                Never
                            {% endif %}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="no-data">No enabled resources found for this connector.</p>
    {% endif %}
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Add click handler for resource table rows
    document.querySelectorAll('.table-row').forEach(row => {
        row.addEventListener('click', function() {
            const url = this.getAttribute('onclick').match(/'([^']+)'/)[1];
            window.location.href = url;
        });
    });
</script>
{% endblock %}
